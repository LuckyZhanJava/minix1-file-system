这是一个java实现的minix1文件系统浏览工具，主要目的是为了了解文件系统的实现。

其中resources目录下的`rootimage-0.12-hd`是一个linux0.12版的硬盘映像文件。整个硬盘划分为四个分区，前三个分区为minix1文件系统，最后一个分区为交换分区。内核运行时如果内存不足，内存中的页会被换出到交换分区上。

硬盘读取的基本单位为1个扇区，大小为`512bytes`，因此硬盘可以被视为一个以512长度byte[]为元素的数组。

在PC通电后，BIOS会先加载磁盘的第一个扇区的内容到内存，这个扇区也叫引导扇区，经过一系列的引导和跳转，完成内核的初始化。因此，在加载文件系统之前，内核操作的基本单位是扇区。

单个扇区只有512bytes大小，内核很难在这块有限的存储中完整存放，所以引导扇区只存储了部分引导代码。当然，引导代码也占据一部分空间，在512bytes的尾部是用来校验引导扇区用的特殊标识。

在引导扇区的头部是不确定长度的内核引导代码，在引导扇区的尾部是2byte长度的引导扇区标识。分区信息表存储在标识之前，并且长度有限。内核通过读取分区标识来挂载文件系统。

分区表内包含了分区的`引导标识`，`文件系统标识`，`开始扇区`和`扇区数量`。

```
Partitions List :
 no    bootInd     sysInd       startSect        nr_sects
  0        128        129               1          132047
  1          0        129          132048          132048
  2          0        129          264096          132048
  3          0        130          396144           82656
```
这里我们研究文件系统在硬盘上的组织。以0-2分区为例，他们的文件系统标识数字129指的是minix1文件系统。

minix1以逻辑块组织扇区，两个扇区为1个逻辑块，内核读取和缓存的单位是逻辑块。逻辑块相比扇区来说，组织起来占用的管理内存更少，效率也要高一些。例如以hash的方式缓存逻辑块要比缓存扇区要少一倍的kv。

minix1的第一个逻辑块在这里是空置的。因为如果把minix1当做唯一的文件系统，那么第一个扇区是引导扇区不能存放别的内容，第一个扇区归属第一个逻辑块，因此第一个逻辑块置为不用。下一个逻辑块是：超级块（`super block`）。

超级块主要记录了:

1. inode的数量。
2. zone的数量。
3. inode的map占用逻辑块数量。
4. zone的map占用的逻辑块数量。

其中，inode代表一个文件，根目录`/`指向序号为1的inode。inode保存了文件的基本信息：包括类型，权限，大小，创建时间和它包含的内容。对于`/`来说，它包含的内容是指它目录下的文件的简单信息：`dir entry`。`dir entry`包含对应文件的inode号和文件名，通过读取inode号对应的inode内容，即可读取到文件名对应的文件信息和内容。

`dir entry`的大小要小于`inode`的大小，`/`目录对应的inode保存的长度为9的`zones[]`不直接存储`inode`的内容，而是存储指向`inode`的`dir entry`，这里`dir entry`像指针一样，占用的内存要远小于它指向的内容。

inode分为两类：目录类和文件类。inode本身记录了文件大小，其中定义的长度为9的`zones[]`指向了它的内容。0-6号zone存储的是一级逻辑块号（逻辑块号指向对应编号的逻辑块，块内存储文件内容），7号zone指向一级逻辑块，块大小1024bytes，包含512个逻辑块号，8号zone指向二级逻辑块，包含512*512个逻辑块号。读取内容时，需要根据inode记录的文件大小，在合适的位置停止读取。

由上可知，每个文件对应一个inode，在超级块内记录了inode的数量，这个数量在文件系统初始化时就已经给定，包括后边zone的数量也是给定的。超级块之后是存储inode和zone使用情况的bitmap的逻辑块，bitmap的长度可能会跨越多个逻辑块，通过修改对应位上的0和1来标识inode和zone的使用情况。再往后是存储inode内容的逻辑块，inode的信息从这里读取。

因此，在创建文件时，需要先从inode的map中查找一个标识位不为1的inode索引，使用索引和name创建dir entry，然后初始化指向的inode，在inode中填入文件的基本信息和内容。
> **对于一个文件来说，如果初始化的大小很小，那么后续的续写操作会在远处产生新的逻辑块，在磁盘上和原始的块并不连续，因此一次性初始化好一个长文件，再修改其中内容对提高读写性能是有益的。**

程序主要实现了浏览文件系统文件内容的功能，支持以下命令：
1. `ll` : 列出目录下的文件。
2. `cd` ： 切换目录。
3. `cat` ： 查看文件内容。
4. `pwd` : 打印当前目录。

```
[root@localhost /]# ll
type       size                 time                 name
  d        272  2004-03-08T22:25:53                    .
  d        272  2004-03-08T22:25:53                   ..
  d        144     1992-01-15T00:00             MCC-0.12
  -        688     1992-01-15T00:00               README
  d        976  2004-04-24T18:14:17                  bin
  d        432  2004-03-11T21:58:11                  dev

[root@localhost /]# cat README

#
# This a root file system for linux 0.1x kernels.
#
# Rebuild from materials gathered from Internet.
#
# 2004.1.4 by Zhao Jiong ( gohigh@sh163.net )
#
# http://oldlinux.org

Now, this is a very basic root file system for linux 0.1x.
I wll add more things to this release soon.

```



